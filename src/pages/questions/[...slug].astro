---
import { getCollection, type CollectionEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const questions = await getCollection('questions');
  return questions.map((question) => ({
    params: { slug: question.slug },
    props: { question },
  }));
}

type Props = {
  question: CollectionEntry<'questions'>;
};

const { question } = Astro.props as Props;
const { Content } = await question.render();
---

<BaseLayout title={question.data.title}>
  <article class="container mx-auto max-w-4xl px-4 py-12">
    <!-- Header -->
    <header class="mb-8">
      <div class="flex items-center gap-2 mb-4">
        <a href="/topics.html" class="text-primary-400 hover:text-primary-300 transition-colors">
          ← Все темы
        </a>
      </div>
      
      <h1 class="text-4xl md:text-5xl font-bold mb-4">
        {question.data.title}
      </h1>
      
      {question.data.description && (
        <p class="text-xl text-gray-400 mb-6">
          {question.data.description}
        </p>
      )}
      
      <!-- Meta info -->
      <div class="flex flex-wrap gap-4 items-center">
        <!-- Category -->
        <span class="px-3 py-1 bg-gray-800 text-gray-300 rounded-full text-sm border border-gray-700">
          {question.data.category}
        </span>
        
        <!-- Difficulty -->
        <span class={`px-3 py-1 rounded-full text-sm font-medium ${
          question.data.difficulty === 'easy' 
            ? 'bg-green-500/20 text-green-400 border border-green-500/30' 
            : question.data.difficulty === 'medium'
            ? 'bg-yellow-500/20 text-yellow-400 border border-yellow-500/30'
            : 'bg-red-500/20 text-red-400 border border-red-500/30'
        }`}>
          {question.data.difficulty === 'easy' ? 'Легко' : question.data.difficulty === 'medium' ? 'Средне' : 'Сложно'}
        </span>
        
        <!-- Tags -->
        {question.data.tags && question.data.tags.map((tag) => (
          <span class="px-3 py-1 bg-primary-500/10 text-primary-400 rounded-full text-sm border border-primary-500/20">
            #{tag}
          </span>
        ))}
      </div>
    </header>
    
    <!-- Content -->
    <div class="prose prose-invert prose-lg max-w-none
      prose-headings:text-gray-100 
      prose-h2:text-3xl prose-h2:font-bold prose-h2:mt-12 prose-h2:mb-6 prose-h2:border-b prose-h2:border-gray-800 prose-h2:pb-4
      prose-h3:text-2xl prose-h3:font-semibold prose-h3:mt-8 prose-h3:mb-4
      prose-p:text-gray-300 prose-p:leading-relaxed
      prose-a:text-primary-400 prose-a:no-underline hover:prose-a:text-primary-300
      prose-strong:text-gray-100 prose-strong:font-semibold
      prose-code:text-primary-400 prose-code:bg-gray-800 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:before:content-[''] prose-code:after:content-['']
      prose-pre:bg-gray-900 prose-pre:border prose-pre:border-gray-800 prose-pre:shadow-lg
      prose-ul:text-gray-300 prose-ul:my-6
      prose-ol:text-gray-300 prose-ol:my-6
      prose-li:my-2
      prose-blockquote:border-l-4 prose-blockquote:border-primary-500 prose-blockquote:bg-gray-800/50 prose-blockquote:py-2 prose-blockquote:px-6
      prose-table:border-collapse prose-table:w-full
      prose-th:bg-gray-800 prose-th:border prose-th:border-gray-700 prose-th:px-4 prose-th:py-2
      prose-td:border prose-td:border-gray-700 prose-td:px-4 prose-td:py-2
    ">
      <Content />
    </div>
    
    <!-- Navigation -->
    <nav class="mt-16 pt-8 border-t border-gray-800">
      <div class="flex justify-between items-center">
        <a 
          href="/topics.html" 
          class="px-6 py-3 bg-gray-800 text-gray-100 rounded-lg hover:bg-gray-700 transition-all border border-gray-700"
        >
          ← Все темы
        </a>
        
        <a 
          href="/index.html" 
          class="px-6 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-all"
        >
          На главную
        </a>
      </div>
    </nav>
  </article>
</BaseLayout>

<style is:global>
  /* Улучшенная подсветка кода */
  pre {
    position: relative;
    overflow-x: auto;
  }
  
  pre code {
    display: block;
    padding: 1.5rem;
    line-height: 1.7;
    font-size: 0.95rem;
  }
  
  /* Таблицы */
  table {
    margin: 2rem 0;
  }
  
  /* Цитаты */
  blockquote {
    margin: 2rem 0;
  }
  
  /* Списки */
  ul, ol {
    padding-left: 1.5rem;
  }
  
  li::marker {
    color: #0ea5e9;
  }
</style>
